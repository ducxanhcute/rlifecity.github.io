var WBB={Board:{}};WBB.Board.Collapsible=WCF.Collapsible.Remote.extend({_getContainers:function(){return $(".wbbBoardList .wbbCollapsibleCategory")},_getTarget:function(e){return this._containers[e].children("ul").first()},_getButtonContainer:function(e){return this._containers[e].find("header h2").first()},_getObjectID:function(e){return this._containers[e].data("boardID")},_updateContent:function(e,t,a){var s=$(t).attr("id",e);this._containers[e].replaceWith(s),this._containers[e]=s,this._initContainer(e,s)},_getAdditionalParameters:function(e){return{depth:this._containers[e].data("depth")}}}),WBB.Board.MarkAllAsRead=Class.extend({_callback:null,_proxy:null,init:function(e){this._callback=e,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(".markAllAsReadButton").click($.proxy(this._click,this))},_click:function(e){e.preventDefault(),this._proxy.setOption("data",{actionName:"markAllAsRead",className:"wbb\\data\\board\\BoardAction"}),this._proxy.sendRequest()},_success:function(e,t,a){if(this._callback&&$.isFunction(this._callback))return this._callback();var s=$(".wbbBoardList");s.find(".new").removeClass("new"),$(".wbbThreadList .new").removeClass("new"),s.find(".badge.badgeUpdate").hide(),$(".mainMenu .active .badge").hide(),elBySelAll(".pageMainMenuMobile .active",void 0,(function(e){elBySelAll(".badge",e.closest(".menuOverlayItem"),elRemove)})),s.find(".wbbBoard .icon32.markAsRead.fa-folder-open").removeClass("fa-folder-open").addClass("fa-folder-open-o"),s.find(".wbbSubBoards .icon16.markAsRead.fa-folder").removeClass("fa-folder").addClass("fa-folder-o"),s.find(".markAsRead").removeClass("markAsRead").unbind("dblclick"),WCF.System.Event.fireEvent("com.woltlab.wcf.MainMenuMobile","updateButtonState")}}),WBB.Board.MarkAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(document).on("dblclick",".wbbBoardList .markAsRead",$.proxy(this._dblClick,this))},_dblClick:function(e){this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\board\\BoardAction",objectIDs:[$(e.currentTarget).parents("li:eq(0)").data("boardID")]}),this._proxy.sendRequest()},_success:function(e,t,a){var s=this;$(".wbbBoardList .markAsRead").each((function(t,a){var i=$(a),n=i.parents("li:eq(0)");WCF.inArray(n.data("boardID"),e.objectIDs)&&s._markAsRead(n,i)}))},_markAsRead:function(e,t){console.debug("Processing "+e.data("boardID")),e.removeClass("new").find(".new:eq(0)").removeClass("new"),t.removeClass("markAsRead"),e.find(".badge:eq(0)").hide(),t.hasClass("fa-folder-open")?t.removeClass("fa-folder-open").addClass("fa-folder-open-o"):t.hasClass("fa-folder")&&t.removeClass("fa-folder").addClass("fa-folder-o"),t.unbind("dblclick");var a=this;e.find("ul:eq(0)").children("li").each((function(e,t){var s=$(t);a._markAsRead(s,s.find(".markAsRead:eq(0)"))}))}}),WBB.Board.MarkAllThreadsAsRead=Class.extend({_boardID:0,_proxy:null,init:function(e){this._boardID=e,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(".markAsReadButton").click($.proxy(this._click,this))},_click:function(e){e.preventDefault(),this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\board\\BoardAction",objectIDs:[this._boardID]}),this._proxy.sendRequest()},_success:function(e,t,a){$(".wbbThreadList .new").each((function(e,t){var a=$(t);a.removeClass("new"),a.find(".firstNewPost").parent().remove(),a.find(".columnAvatar").off("dblclick")}))}}),WBB.Board.IgnoreBoards=Class.extend({_dialog:null,_didInit:!1,_proxy:null,init:function(){$(".ignoreBoardsButton").click($.proxy(this._click,this))},_click:function(e){e.preventDefault(),this._didInit?this._dialog.wcfDialog("open"):(this._dialog=$("<div />").hide().appendTo(document.body),this._proxy=new WCF.Action.Proxy({autoSend:!0,data:{actionName:"loadIgnoredBoards",className:"wbb\\data\\board\\BoardAction"},success:$.proxy(this._success,this)}),this._didInit=!0)},_initBoardList:function(){this._dialog.find("input[type=submit]").click($.proxy(this._submit,this)),this._dialog.find("input[type=checkbox]").click($.proxy(this._checkboxClick,this)),this._dialog.find("li").each((function(e,t){var a=$(t);!1===a.data("ignorable")&&a.find("input[type=checkbox]:eq(0)").prop("checked","checked").disable().css("cursor","default").off("click")}))},_checkboxClick:function(e){var t=$(e.currentTarget),a=t[0].checked;t.parents("li:eq(0)").find("ul input[type=checkbox]").each((function(){this.checked=a,this.disabled=!a}))},_submit:function(){var e=[];this._dialog.find("input[type=checkbox]:not(:checked)").each((function(){e.push($(this).val())})),this._dialog.find("input[type=submit]").disable(),this._proxy.setOption("data",{actionName:"saveIgnoredBoards",className:"wbb\\data\\board\\BoardAction",objectIDs:e}),this._proxy.sendRequest()},_success:function(e,t,a){"loadIgnoredBoards"===e.actionName?(this._dialog.html(e.returnValues.template),this._initBoardList(),this._dialog.wcfDialog({title:WCF.Language.get("wbb.index.ignoreBoards")})):((new WCF.System.Notification).show(),this._dialog.wcfDialog("close"),this._dialog.find("input[type=submit]").enable(),$(".wbbBoardList:eq(0)").html(e.returnValues.template))}}),WBB.Thread={},WBB.Thread.MarkAsRead=Class.extend({_proxy:null,init:function(){this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),$(document).on("dblclick",".wbbThreadList .new .columnAvatar",$.proxy(this._dblclick,this))},_dblclick:function(e){this._proxy.setOption("data",{actionName:"markAsRead",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[$(e.currentTarget).parents("ol:eq(0)").data("threadID")]}),this._proxy.sendRequest()},_success:function(e,t,a){$(".wbbThreadList .new").each((function(t,a){var s=$(a);WCF.inArray(s.data("threadID"),e.objectIDs)&&(s.removeClass("new"),s.find(".firstNewPost").parent().remove(),s.find(".columnAvatar").off("dblclick"))}))}}),WBB.Thread.Editor={_callbacks:[],_dialog:null,_dialogContainer:null,_environment:"",_notification:null,_proxy:null,_threadID:0,beginEdit:function(e,t){this._callbacks=[],this._environment=e,this._threadID=t,null===this._proxy&&(this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)})),this._proxy.setOption("data",{actionName:"beginEdit",className:"wbb\\data\\thread\\ThreadAction",parameters:{data:{threadID:this._threadID}}}),this._proxy.sendRequest()},registerCallback:function(e){this._callbacks.push(e)},_success:function(e,t,a){switch(e.returnValues.actionName){case"beginEdit":this._showEditor(e);break;case"saveEdit":this._saveEdit(e)}},_showEditor:function(e){var t,a,s;null===this._dialog?(this._dialogContainer=$('<div id="threadEditor" />').data("wbbThreadEditor",this).hide().appendTo(document.body),this._dialog=$("<div />").appendTo(this._dialogContainer),t=$('<div class="formSubmit" />').appendTo(this._dialogContainer),a=$('<button class="buttonPrimary">'+WCF.Language.get("wcf.global.button.save")+"</button>").appendTo(t),$("<button>"+WCF.Language.get("wcf.global.button.cancel")+"</button>").appendTo(t).click($.proxy(this._cancel,this)),a.click($.proxy(this._save,this))):$("#threadEditorLanguageIDContainer").length&&require(["WoltLabSuite/Core/Language/Chooser"],(function(e){e.removeChooser("threadLanguageID")})),this._dialogContainer.data("threadID",e.returnValues.threadID),this._dialog.html(e.returnValues.template),s=this,this._dialog.find("#topic").keyup((function(e){if(e.which===$.ui.keyCode.ENTER)return s._save(),e.preventDefault(),!1})),this._dialogContainer.wcfDialog({title:WCF.Language.get("wbb.thread.edit")}),this._dialogContainer.wcfDialog("render")},_save:function(){var e,t,a={},s=this._dialog.find("fieldset, .section");if(s.length){for(s.each($.proxy((function(e,t){var s=$(t),i=s.attr("id").replace(/^threadEditor/,"").toLowerCase();a[i]=this._getValues(s)}),this)),e=0,t=this._callbacks.length;e<t;e++)a=this._callbacks[e].getValues(this._dialog,a);$.getLength(a)&&(this._proxy.setOption("data",{actionName:"saveEdit",className:"wbb\\data\\thread\\ThreadAction",parameters:{data:{values:a,threadID:this._threadID}}}),this._proxy.sendRequest())}},_saveEdit:function(e){var t,a;if(e.returnValues.errors&&$.getLength(e.returnValues.errors))for(this._dialog.find("small.innerError").remove(),t=0,a=this._callbacks.length;t<a;t++)"function"==typeof this._callbacks[t].showErrors&&this._callbacks[t].showErrors(e.returnValues.errors);else if(null===this._notification&&(this._notification=new WCF.System.Notification(WCF.Language.get("wcf.global.success.edit"))),e.returnValues.forceReload)this._notification.show((function(){window.location.reload()}),void 0,WCF.Language.get("wcf.global.success.edit"));else{for(t in this._callbacks)this._callbacks[t].saved(this._environment,this._threadID,e);this._dialogContainer.wcfDialog("close"),this._notification.show()}},_getValues:function(e){var t={};return e.find("input:not([type=radio])").each((function(e,a){var s=$(a);"checkbox"===s.attr("type")?t[s.attr("id")]=s.prop("checked")?1:0:t[s.attr("id")]=s.val()})),e.find("input[type=radio]:checked").each((function(e,a){var s=$(a);t[s.attr("name")]=s.val()})),e.find("select").each((function(e,a){var s=$(a);t[s.attr("id")]=s.val()})),t},_cancel:function(){this._dialogContainer.wcfDialog("close")}},WBB.Thread.Editor.Default=Class.extend({init:function(){$("#threadEditor").data("wbbThreadEditor").registerCallback(this),this._handleThreadType()},_handleThreadType:function(){var e=$("#threadEditorAnnouncementLabel"),t=$("#threadEditorAnnouncementContainer"),a=function(a,s){switch(a){case 0:case 1:e.hide(),t.hide(),s||$("#threadEditor").wcfDialog("render");break;case 2:e.show(),t.show(),s||$("#threadEditor").wcfDialog("render")}},s=$("#threadEditor input[name=type]").click((function(e){a(parseInt($(e.currentTarget).val()),!1)}));s.each((function(e,t){var s=$(t);if(s.is(":checked"))return a(parseInt(s.val()),!0),!1}))},_click:function(e){this._type=parseInt($(e.currentTarget).prop("value")),this._update()},_update:function(){this._type},getValues:function(e,t){return t},saved:function(e,t,a){void 0!==a.returnValues.default&&("board"===e?$("#thread"+t+" .columnSubject > h3 > a").text(a.returnValues.default.topic):$('.contentHeader[data-thread-id="'+t+'"] .contentTitle').text(a.returnValues.default.topic))},showErrors:function(e){if(e.default)for($fieldName in e.default)$('<small class="innerError">'+e.default[$fieldName]+"</small>").insertAfter($("#threadEditorDefault #"+$fieldName))}}),WBB.Thread.Editor.LabelChooser=WCF.Label.Chooser.extend({init:function(e,t,a,s){this._super(e,t,a,s),$("#threadEditor").data("wbbThreadEditor").registerCallback(this)},getValues:function(e,t){var a,s;for(a in t.label={},this._groups)void 0!==(s=this._groups[a]).data("labelID")&&(t.label[a]=s.data("labelID"));return t},saved:function(e,t,a){var s,i,n,o,r,d,l;if(void 0!==a.returnValues.label)if(o=a.returnValues.label.labels,r=null,"board"===e)for((r=(d=$("#thread"+t+" > .columnSubject")).children(".labelList")).length?o.length?r.empty():r.remove():o.length&&(r=$('<ul class="labelList" />').prependTo(d)),s=0;s<o.length;s++)i=o[s],(n=$('<li><a href="'+i.link+'" class="badge label '+i.cssClassName+'">'+WCF.String.escapeHTML(i.label)+"</a></li>").appendTo(r)).before(" ");else for((r=(l=$("header.wbbThread[data-thread-id="+t+"]")).find(".labelList")).length?o.length?r.empty():r.parent().remove():o.length&&(n=$('<li><span class="icon icon16 fa-tags"></span> </li>').prependTo(l.find(".contentHeaderMetaData")),r=$('<ul class="labelList" />').appendTo(n)),s=0;s<o.length;s++)i=o[s],(n=$('<li><span class="badge label '+i.cssClassName+'">'+WCF.String.escapeHTML(i.label)+"</span></li>").appendTo(r)).after(" ")},showErrors:function(e){e.label&&$("#threadEditorLabel").find(".labelList").each((function(t,a){var s=$(a),i=s.data("objectID");e.label.labelIDs[i]&&$('<small class="innerError">'+WCF.Language.get("wcf.label.error.missing")+"</small>").insertAfter(s)}))}}),WBB.Thread.Editor.Language=WCF.Language.Chooser.extend({init:function(e,t,a,s,i,n){this._languages=s,this._super(e,t,a,s,i,n),$("#threadEditor").data("wbbThreadEditor").registerCallback(this)},getValues:function(e,t){return t.default.threadLanguageID&&(t.default.languageID=t.default.threadLanguageID,delete t.default.threadLanguageID),t},saved:function(e,t,a){"board"===e&&$("#thread"+t+" > .columnSubject .statusDisplay .iconFlag").attr("src",this._languages[a.returnValues.default.languageID].iconPath)}}),WBB.Thread.Editor.TagList=Class.extend({_api:null,init:function(){$("#threadEditor").data("wbbThreadEditor").registerCallback(this),require(["WoltLabSuite/Core/Ui/ItemList","Ui/SimpleDropdown"],function(e,t){t.destroy("tagSearchInputThread"),this._api=e}.bind(this))},getValues:function(e,t){var a,s,i,n;for(delete t.tags,a=[],i=0,n=(s=this._api.getValues("tagSearchInputThread")).length;i<n;i++)a.push(s[i].value);return t.tag=a.length?a:["__wcf_noTags"],t},saved:function(e,t,a){}}),WBB.Thread.InlineEditor=WCF.InlineEditor.extend({_advancedIsDisabled:!1,_boardID:0,_environment:"thread",_permissions:{},_redirectURL:"",_updateHandler:null,_setOptions:function(){this._boardID=0,this._environment="thread",this._options=[{label:WCF.Language.get("wbb.thread.edit.done"),optionName:"done"},{label:WCF.Language.get("wbb.thread.edit.undone"),optionName:"undone"},{label:WCF.Language.get("wbb.thread.edit.close"),optionName:"close"},{label:WCF.Language.get("wbb.thread.edit.open"),optionName:"open"},{label:WCF.Language.get("wbb.thread.edit.sticky"),optionName:"sticky"},{label:WCF.Language.get("wbb.thread.edit.scrape"),optionName:"scrape"},{label:WCF.Language.get("wbb.thread.edit.enable"),optionName:"enable"},{label:WCF.Language.get("wbb.thread.edit.disable"),optionName:"disable"},{label:WCF.Language.get("wbb.thread.edit.move"),optionName:"move"},{label:WCF.Language.get("wbb.thread.edit.removeLink"),optionName:"removeLink"},{label:WCF.Language.get("wbb.thread.edit.trash"),optionName:"trash"},{label:WCF.Language.get("wbb.thread.edit.restore"),optionName:"restore"},{label:WCF.Language.get("wbb.thread.edit.delete"),optionName:"delete"},{optionName:"divider"},{label:WCF.Language.get("wbb.thread.edit.markThread"),optionName:"markThread"},{label:WCF.Language.get("wbb.thread.edit.unmarkThread"),optionName:"unmarkThread"},{label:WCF.Language.get("wbb.thread.edit.markPosts"),optionName:"markPosts"},{label:WCF.Language.get("wbb.thread.edit.advanced"),optionName:"advanced",isQuickOption:!0}]},setUpdateHandler:function(e){this._updateHandler=e},_getTriggerElement:function(e){return e.find(".jsThreadInlineEditor")},_validate:function(e,t){var a,s=$("#"+e).data("threadID");if(this._updateHandler.getValue(s,"isLink"))return!("removeLink"!==t||!this._getPermission("canMoveThread"));switch(t){case"close":case"open":return!!this._getPermission("canCloseThread")&&("open"===t?this._updateHandler.getValue(s,"isClosed"):!this._updateHandler.getValue(s,"isClosed"));case"delete":return!!this._getPermission("canDeleteThreadCompletely")&&this._updateHandler.getValue(s,"isDeleted");case"done":case"undone":return!!this._updateHandler.getValue(s,"canMarkAsDone")&&("undone"===t?this._updateHandler.getValue(s,"isDone"):!this._updateHandler.getValue(s,"isDone"));case"restore":return!!this._getPermission("canRestoreThread")&&this._updateHandler.getValue(s,"isDeleted");case"trash":return!!this._getPermission("canDeleteThread")&&!this._updateHandler.getValue(s,"isDeleted");case"sticky":case"scrape":return!(!this._getPermission("canPinThread")||this._updateHandler.getValue(s,"isAnnouncement"))&&("scrape"===t?this._updateHandler.getValue(s,"isSticky"):!this._updateHandler.getValue(s,"isSticky"));case"enable":return!!this._getPermission("canEnableThread")&&(!this._updateHandler.getValue(s,"isDeleted")&&this._updateHandler.getValue(s,"isDisabled"));case"disable":return!!this._getPermission("canEnableThread")&&(!this._updateHandler.getValue(s,"isDeleted")&&!this._updateHandler.getValue(s,"isDisabled"));case"move":return this._getPermission("canMoveThread");case"markThread":return"thread"===this._environment&&((a=document.getElementById("wbbThreadClipboardMark"))&&!a.checked);case"unmarkThread":return"thread"===this._environment&&((a=document.getElementById("wbbThreadClipboardMark"))&&a.checked);case"markPosts":return"thread"===this._environment&&Array.from(document.querySelectorAll(".wbbThreadPostList .wbbPost .jsClipboardItem")).some((e=>!e.checked));case"advanced":return!this._advancedIsDisabled}return!1},_execute:function(e,t){var a,s,i,n,o;if(!this._validate(e,t))return!1;switch(t){case"close":case"open":a="open"===t?0:1,this._updateThread(e,t,{isClosed:a});break;case"sticky":case"scrape":s="scrape"===t?0:1,this._updateThread(e,t,{isSticky:s});break;case"done":case"undone":i="done"===t?1:0,this._updateThread(e,t,{isDone:i});break;case"enable":require(["WoltLabSuite/Forum/Ui/Thread/Enable"],function(a){a.init(this._elements[e].data("threadID"),function(a,s){a?this._updateThread(e,t,{isDisabled:0,updateTime:s}):window.location.reload()}.bind(this))}.bind(this));break;case"disable":this._updateThread(e,t,{isDisabled:1});break;case"move":n=this._elements[e].data("threadID"),WBB.Thread.MoveHandler.prepare([n],$.proxy((function(e){this._updateHandler.update(n,e.returnValues.threadData[n])}),this),this._boardID,this._environment);break;case"removeLink":this._updateThread(e,t,{removeLink:1});break;case"delete":o=this,WCF.System.Confirmation.show(WCF.Language.get("wbb.thread.confirmDelete"),(function(a){"confirm"===a&&o._updateThread(e,t,{deleted:1})}));break;case"restore":this._updateThread(e,t,{isDeleted:0});break;case"trash":o=this,WCF.System.Confirmation.show(WCF.Language.get("wbb.thread.confirmTrash"),(function(a){"confirm"===a&&o._updateThread(e,t,{isDeleted:1,reason:$("#wcfSystemConfirmationContent").find("textarea").val()})}),{},$('<div class="section"><dl><dt>'+WCF.Language.get("wbb.thread.confirmTrash.reason")+'</dt><dd><textarea cols="40" rows="4" /></dd></dl></div>'));break;case"markThread":case"unmarkThread":document.getElementById("wbbThreadClipboardMark").click();break;case"markPosts":document.querySelectorAll(".wbbThreadPostList .wbbPost .jsClipboardItem").forEach((e=>{e.checked||e.click()}));break;case"advanced":WBB.Thread.Editor.beginEdit(this._environment,this._elements[e].data("threadID"));break;default:return!1}return!0},_updateThread:function(e,t,a){var s,i;"delete"===t||"removeLink"===t?(s=this,i=this._elements[e].data("threadID"),new WCF.Action.Proxy({autoSend:!0,data:{actionName:t,className:"wbb\\data\\thread\\ThreadAction",objectIDs:[i]},success:function(e){s._updateHandler.update(i,e.returnValues.threadData[i])}})):(this._updateData.push({data:a,elementID:e,optionName:t}),this._proxy.setOption("data",{actionName:t,className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._elements[e].data("threadID")],parameters:{data:a}}),this._proxy.sendRequest())},_updateState:function(){var e,t,a,s;for(this._notification.show(),e=0,t=this._updateData.length;e<t;e++){if(void 0!==(a=this._updateData[e]).data.isSticky&&this._redirectURL)return void(window.location=this._redirectURL);if(void 0!==a.data.isDisabled&&0===a.data.isDisabled)return void window.location.reload();s=$("#"+a.elementID).data("threadID"),this._updateHandler.update(s,a.data)}},_getPermission:function(e){return this._permissions[e]?this._permissions[e]:0},disableAdvancedOptions:function(e){void 0===e&&(e=!0),this._advancedIsDisabled=!!e},setEnvironment:function(e,t,a){"board"!==e&&(e="thread"),this._boardID=t||0,this._environment=e,this._redirectURL=a},setPermission:function(e,t){this._permissions[e]=t},setPermissions:function(e){for(var t in e)this.setPermission(t,e[t])}}),WBB.Thread.Clipboard=Class.extend({_boardID:0,_environment:"board",_updateHandler:null,init:function(e,t,a){this._updateHandler=e,this._environment=t,this._boardID=a||0,require(["EventHandler"],function(e){e.add("com.woltlab.wcf.clipboard","com.woltlab.wbb.thread",this._clipboardAction.bind(this))}.bind(this))},_clipboardAction:function(e){switch(e.data.actionName){case"com.woltlab.wbb.thread.assignLabel":WBB.Thread.AssignLabelHandler.prepare(e.data.parameters);break;case"com.woltlab.wbb.thread.copy":WBB.Thread.CopyHandler.prepare(e.data.parameters);break;case"com.woltlab.wbb.thread.merge":new WBB.Thread.MergeHandler(e.data.parameters.objectIDs).load();break;case"com.woltlab.wbb.thread.move":WBB.Thread.MoveHandler.prepare(e.data.parameters.objectIDs,$.proxy(this._move,this),this._boardID,this._environment)}null!==e.responseData&&this._evaluateResponse(void 0,e.responseData,"com.woltlab.wbb.thread",e.data.actionName,null)},_move:function(e){window.location.reload()},_evaluateResponse:function(e,t,a,s,i){if("com.woltlab.wbb.thread"===a&&t.returnValues.threadData&&$.getLength(t.returnValues.threadData)){for(var n in t.returnValues.threadData)this._updateHandler.update(n,t.returnValues.threadData[n],!1);WCF.Clipboard.reload()}}}),WBB.Thread.UpdateHandler=Class.extend({_markAsDoneHandler:null,_threads:{},init:function(){var e=this;$(".wbbThread").each((function(t,a){var s=$(a);e._threads[s.data("threadID")]=s}))},setMarkAsDoneHandler:function(e){this._markAsDoneHandler=e},update:function(e,t,a){if(t.moved)window.location.reload();else if(this._threads[e]){for(var s in t)this._updateProperty(e,s,t[s]);!1!==a&&WCF.Clipboard.reload()}else console.debug("[WBB.Thread.UpdateHandler] Unknown thread id "+e)},_updateProperty:function(e,t,a){switch(t){case"deleted":this._delete(e,a);break;case"deleteNote":this._deleteNote(e,a);break;case"isClosed":a?this._close(e):this._open(e);break;case"isDeleted":a?this._trash(e):this._restore(e);break;case"isDisabled":a?this._disable(e):this._enable(e);break;case"isDone":a?this._done(e):this._undone(e);break;case"isSticky":a?this._sticky(e):this._scrape(e);break;case"moved":this._moved(e);break;case"showMoveNotice":this._showMoveNotice(e);break;case"title":this._updateTitle(e,a);break;default:this._handleCustomProperty(e,t,a)}},_handleCustomProperty:function(e,t,a){this._threads[e].trigger("threadUpdateHandlerProperty",[e,t,a])},_close:function(e){this._threads[e].data("isClosed",1)},_delete:function(e,t){},_deleteNote:function(e,t){},_disable:function(e){this._threads[e].data("isDisabled",1)},_done:function(e){this._threads[e].data("isDone",1)},_enable:function(e){this._threads[e].data("isDisabled",0)},_moved:function(e){},_open:function(e){this._threads[e].data("isClosed",0)},_restore:function(e){this._threads[e].data("isDeleted",0)},_scrape:function(e){this._threads[e].data("isSticky",0)},_sticky:function(e){this._threads[e].data("isSticky",1)},_trash:function(e){this._threads[e].data("isDeleted",1)},_undone:function(e){this._threads[e].data("isDone",0)},_updateTitle:function(e,t){},_getCloseIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.closed")+'" class="icon icon16 fa-lock jsTooltip jsIconClosed" /></li>')},_getDoneIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.done")+'" class="icon icon16 fa-check-square-o jsTooltip jsIconDone wbbMarkAsDone" /></li>')},_getMoveIcon:function(){return $('<span title="'+WCF.Language.get("wbb.thread.moved")+'" class="icon icon16 fa-arrow-right jsTooltip jsIconMoved wbbMovedIcon" />')},_getUndoneIcon:function(){return $('<li><span title="'+WCF.Language.get("wbb.thread.undone")+'" class="icon icon16 fa-square-o jsTooltip jsIconUndone wbbMarkAsDone" /></li>')},getValue:function(e,t){if(this._threads[e])switch(t){case"isAnnouncement":return this._threads[e].data("isAnnouncement");case"isClosed":return this._threads[e].data("isClosed");case"isDeleted":return this._threads[e].data("isDeleted");case"isDisabled":return this._threads[e].data("isDisabled");case"isDone":return this._threads[e].data("isDone");case"isSticky":return this._threads[e].data("isSticky");case"isLink":return this._threads[e].data("isLink");case"canMarkAsDone":return this._threads[e].data("canMarkAsDone")}else console.debug("[WBB.Thread.UpdateHandler] Unknown thread id "+e)}}),WBB.Thread.UpdateHandler.Board=WBB.Thread.UpdateHandler.extend({_close:function(e){this._super(e),this._getCloseIcon().appendTo(this._threads[e].find(".statusIcons"))},_delete:function(e,t){this._threads[e].parent().remove(),delete this._threads[e],WCF.Clipboard.reload()},_deleteNote:function(e,t){$('<small class="wbbThreadDeleteNote">'+t+"</small>").appendTo(this._threads[e].find(".columnSubject"))},_disable:function(e){this._super(e),this._threads[e].addClass("messageDisabled")},_done:function(e){this._super(e);var t=this._threads[e].find(".jsMarkAsDone");t.removeClass("fa-square-o").addClass("fa-check-square-o"),t.prop("title",WCF.Language.get("wbb.thread.done"))},_enable:function(e){this._super(e),this._threads[e].removeClass("messageDisabled")},_moved:function(e){window.location.reload()},_showMoveNotice:function(e){this._getMoveIcon().appendTo(this._threads[e].find(".columnAvatar > div"))},_open:function(e){this._super(e),this._threads[e].find(".jsIconClosed").parent().remove()},_restore:function(e){this._super(e),this._threads[e].removeClass("messageDeleted"),this._threads[e].find(".columnSubject > .wbbThreadDeleteNote").remove()},_trash:function(e){this._super(e),this._threads[e].addClass("messageDeleted")},_undone:function(e){this._super(e);var t=this._threads[e].find(".jsMarkAsDone");t.removeClass("fa-check-square-o").addClass("fa-square-o"),t.prop("title",WCF.Language.get("wbb.thread.undone"))}}),WBB.Thread.UpdateHandler.Thread=WBB.Thread.UpdateHandler.extend({_boardID:0,_postManager:null,init:function(e){this._boardID=e,this._super()},setPostHandler:function(e){this._postManager=e},update:function(e,t){this._threads[e]&&(void 0===t.isDeleted||t.isDeleted||void 0===t.ignoreDeletedPosts||(this._restore(e,!0),delete t.isDeleted,delete t.ignoreDeletedPosts),void 0===t.isDisabled||t.isDisabled||void 0===t.ignoreDisabledPosts||(this._enable(e,!0),delete t.isDisabled,delete t.ignoreDisabledPosts)),this._super(e,t)},_close:function(e){var t,a,s;this._super(e),$('<li><span class="icon icon16 fa-lock jsIconClosed"></span> '+WCF.Language.get("wbb.thread.closed")+"</li>").appendTo(this._threads[e].find("ul.contentHeaderMetaData")),(t=elBySel(".messageQuickReplyContent .redactor-box"))&&(null!==(a=t.previousElementSibling)&&a.classList.contains("jsClosedThreadWarning")||((a=elCreate("p")).className="warning jsClosedThreadWarning",a.textContent=WCF.Language.get("wbb.thread.closedThread"),t.parentNode.insertBefore(a,t)),(s=elBySel('#settings_text input[name="closeThread"]'))&&(s.checked=!0))},_delete:function(e,t){new WCF.PeriodicalExecuter((function(e){e.stop(),window.location=t}),1e3)},_disable:function(e){this._super(e),this._postManager.updateAllItems({isDisabled:1}),this._threads[e].addClass("messageDisabled")},_done:function(e){this._super(e),this._threads[e].find(".jsMarkAsDone").find(".icon").removeClass("fa-square-o").addClass("fa-check-square-o").next().text(WCF.Language.get("wbb.thread.done"))},_enable:function(e,t){this._super(e),t||this._postManager.updateAllItems({isDisabled:0}),this._threads[e].removeClass("messageDisabled")},_moved:function(e){window.location.reload()},_showMoveNotice:function(e){window.location.reload()},_open:function(e){var t,a;this._super(e),this._threads[e].find("span.jsIconClosed").parent().remove(),(t=elBySel(".messageQuickReplyContent .jsClosedThreadWarning"))&&elRemove(t),(a=elBySel('#settings_text input[name="closeThread"]'))&&(a.checked=!1)},_scrape:function(e){this._super(e),this._threads[e].find("span.jsIconSticky").remove()},_sticky:function(e){this._super(e),$('<span class="icon icon16 fa-thumb-tack jsTooltip jsIconSticky wbbStickyIcon" title="'+WCF.Language.get("wbb.thread.sticky")+'"></span>').appendTo(this._threads[e].find(".contentHeaderIcon"))},_restore:function(e,t){this._super(e),t||this._postManager.updateAllItems({isDeleted:0}),this._threads[e].removeClass("messageDeleted")},_trash:function(e){this._super(e),this._postManager.updateAllItems({isDeleted:1}),this._threads[e].addClass("messageDeleted")},_undone:function(e){this._super(e),this._threads[e].find(".jsMarkAsDone").find(".icon").removeClass("fa-check-square-o").addClass("fa-square-o").next().text(WCF.Language.get("wbb.thread.undone"))}}),WBB.Thread.MergeHandler=Class.extend({_className:"",_dialog:null,_dialogTitle:"",_objectIDs:[],_proxy:null,_successMessage:"",init:function(e){this._className="wbb\\data\\thread\\ThreadAction",this._dialogTitle=WCF.Language.get("wbb.thread.edit.merge"),this._objectIDs=e,this._successMessage=WCF.Language.get("wbb.thread.edit.merge.success"),this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)})},load:function(){this._proxy.setOption("data",{actionName:"prepareMerge",className:this._className,objectIDs:this._objectIDs}),this._proxy.sendRequest()},_success:function(e,t,a){var s;e.returnValues.redirectURL?new WCF.System.Notification(this._successMessage).show((function(){window.location=e.returnValues.redirectURL})):(null===this._dialog?(this._dialog=$("<div />").hide().appendTo(document.body),this._dialog.html(e.returnValues.template),this._dialog.wcfDialog({title:this._dialogTitle})):(this._dialog.html(e.returnValues.template),this._dialog.wcfDialog("show")),s=this._dialog.find(".formSubmit > button[data-type=submit]").disable().click($.proxy(this._submit,this)),this._dialog.find("input[type=radio]").change((function(){s.enable()})))},_submit:function(){this._dialog.find(".formSubmit > button[data-type=submit]").disable(),this._proxy.setOption("data",{actionName:"merge",className:this._className,objectIDs:this._objectIDs,parameters:this._getParameters()}),this._proxy.sendRequest()},_getParameters:function(){return{threadID:this._dialog.find("input[type=radio]:checked").val()}}}),WBB.Thread.AssignLabelHandler={_boardID:0,_dialog:null,_objectIDs:[],prepare:function(e){this._boardID=e.boardID,this._objectIDs=e.objectIDs,null===this._dialog?(this._dialog=$("<div />").appendTo(document.body),this._dialog.html(e.template),this._dialog.wcfDialog({title:WCF.Language.get("wbb.thread.edit.assignLabel")})):(this._dialog.html(e.template),this._dialog.wcfDialog("open")),this._dialog.find(".formSubmit > .buttonPrimary").click($.proxy(this._click,this))},_click:function(){var e={};this._dialog.find(".labelList > .dropdown").each((function(t,a){var s=$(a);s.data("labelID")&&(e[s.data("groupID")]=s.data("labelID"))})),new WCF.Action.Proxy({autoSend:!0,data:{actionName:"assignLabel",className:"wbb\\data\\thread\\ThreadAction",objectIDs:this._objectIDs,parameters:{boardID:this._boardID,labelIDs:e}},success:$.proxy(this._success,this)})},_success:function(e,t,a){var s,i,n,o,r,d=e.returnValues.labels;for(s=0;s<e.objectIDs.length;s++)for((n=(i=$("#thread"+e.objectIDs[s]+" > .columnSubject")).children(".labelList")).length?d.length?n.empty():n.remove():d.length&&(n=$('<ul class="labelList" />').prependTo(i)),o=0;o<d.length;o++)r=d[o],$('<li><a href="'+r.link+'" class="badge label '+r.cssClassName+'">'+WCF.String.escapeHTML(r.label)+"</a></li>").appendTo(n).before(" ");this._dialog.wcfDialog("close"),WCF.Clipboard.reload(),(new WCF.System.Notification).show()}},WBB.Thread.CopyHandler={_boardID:0,_i:0,_objectIDs:[],prepare:function(e){this._boardID=e.boardID,this._i=0,this._objectIDs=e.objectIDs,this.copy()},copy:function(e){!0===e&&this._i++;var t=WCF.Language.get("wbb.thread.copy.title",{count:this._objectIDs.length,item:this._i+1});this._i+1==this._objectIDs.length?new WCF.System.Worker("copy","wbb\\data\\thread\\ThreadAction",t,{boardID:this._boardID,sourceThreadID:this._objectIDs[this._i]}):new WCF.System.Worker("copy","wbb\\data\\thread\\ThreadAction",t,{boardID:this._boardID,sourceThreadID:this._objectIDs[this._i]},(function(e){e._dialog.wcfDialog("option","onClose",null),e._dialog.wcfDialog("option","closeConfirmMessage",null),e._dialog.wcfDialog("close"),WBB.Thread.CopyHandler.copy(!0)}))}},WBB.Thread.MoveHandler={_boardID:0,_callback:null,_dialog:null,_didInit:!1,_environment:"",_proxy:null,_threadIDs:[],_init:function(){this._dialog=$("<div />").hide().appendTo(document.body),this._proxy=new WCF.Action.Proxy,this._didInit=!0},prepare:function(e,t,a,s){$.isFunction(t)?(this._callback=t,this._boardID=a||0,this._threadIDs=e,this._environment=s,this._didInit||this._init(),this._proxy.setOption("data",{actionName:"prepareMove",className:"wbb\\data\\thread\\ThreadAction",objectIDs:this._threadIDs,parameters:{boardID:this._boardID}}),this._proxy.setOption("success",$.proxy(this._success,this)),this._proxy.sendRequest()):console.debug("[WBB.Thread.MoveHandler] Given callback is invalid.")},_success:function(e,t,a){this._dialog.data("objectIDs",e.objectIDs).html(e.returnValues.template),this._dialog.wcfDialog({title:WCF.Language.get("wbb.thread.edit.moveThreads")}),this._dialog.find(".formSubmit > input[type=submit]").click($.proxy(this._move,this))},_move:function(e){var t=this._dialog.find("#showMoveNotice").prop("checked"),a=parseInt(this._dialog.find("#boardID").prop("value"));if(a){if(a==this._boardID&&1==this._threadIDs.length&&"thread"===this._environment)return this._dialog.find("#boardID").next("small.innerError").remove(),void $('<small class="innerError">'+WCF.Language.get("wbb.thread.edit.moveDestination.error.equalsOrigin")+"</small>").insertAfter(this._dialog.find("#boardID"));this._proxy.setOption("data",{actionName:"move",className:"wbb\\data\\thread\\ThreadAction",objectIDs:this._dialog.data("objectIDs"),parameters:{boardID:a,showMoveNotice:t}}),this._proxy.setOption("success",$.proxy((function(e){this._callback(e)}),this)),this._proxy.sendRequest()}this._dialog.wcfDialog("close")}},WBB.Thread.TypeChooser=Class.extend({_boardIDsContainer:null,_type:0,init:function(e){var t,a;this._type=parseInt(e),this._boardIDsContainer=$("#boardIDsContainer"),t=$("input[name=type]").click($.proxy(this._click,this)),a=this,t.each((function(e,t){var s=$(t);if(s.prop("value")==a._type)return s.prop("checked","checked"),a._update(),!1}))},_click:function(e){this._type=parseInt($(e.currentTarget).prop("value")),this._update()},_update:function(){switch(this._type){case 0:case 1:this._boardIDsContainer.hide();break;case 2:this._boardIDsContainer.show()}}}),WBB.Thread.LastPageHandler=Class.extend({_action:"",_isLoading:!1,_lastPostTime:0,_pageNo:0,_proxy:null,_threadID:0,init:function(e,t,a){this._isLoading=!1,this._lastPostTime=t,this._pageNo=a,this._threadID=e,this._action="",this._proxy=new WCF.Action.Proxy({showLoadingOverlay:!1,success:$.proxy(this._success,this),suppressErrors:!0}),new WCF.Action.Scroll(300,$.proxy(this._scroll,this),window,".wbbThreadPostList")},_scroll:function(e){e.stop(),this._action="getNewPosts",this._proxy.setOption("data",{actionName:"getNewPosts",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._threadID],parameters:{countPosts:!0,lastPostTime:this._lastPostTime}}),this._proxy.sendRequest()},_success:function(e,t,a){var s,i,n=elById("messageQuickReply");null!==n&&(n.previousElementSibling.classList.contains("messageListPagination")&&(n=n.previousElementSibling),"getNewPosts"===this._action?e.returnValues.newPostsCount>0&&(s=WCF.Language.get("wbb.thread.newPosts",{newPostsCount:e.returnValues.newPostsCount}),$('<li class="wbbMorePostsNotice"><p id="wbbNewPostsLink" class="info pointer">'+s+"</p></li>").insertBefore(n).click($.proxy(this._click,this))):e.returnValues.redirectURL?window.location=e.returnValues.redirectURL:($("#wbbNewPostsLink").parent().remove(),$(e.returnValues.template).insertBefore(n),e.returnValues.nextPageNotice&&$('<li class="wbbMorePostsNotice"><p class="info" role="status">'+e.returnValues.nextPageNotice+"</p></li>").insertBefore(n),(i=elById("messageQuickReply"))&&elData(i,"last-post-time",e.returnValues.lastPostTime)))},_click:function(e){if(this._isLoading)return!1;$(e.currentTarget).removeClass("pointer"),this._isLoading=!0,this._action="loadPosts",this._proxy.setOption("data",{actionName:"getNewPosts",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[this._threadID],parameters:{countPosts:!1,lastPostTime:this._lastPostTime,pageNo:this._pageNo}}),this._proxy.sendRequest()}}),WBB.Thread.MarkAsDone=Class.extend({_proxy:null,_updateHandler:null,_threads:{},init:function(e){this._updateHandler=e,this._threads={},this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)});var t=this;$(".wbbThread").each((function(e,a){var s=$(a),i=s.data("threadID");t._threads[i]=s,s.data("canMarkAsDone")&&t.watch(i)})),this._updateHandler.setMarkAsDoneHandler(this)},watch:function(e){this._threads[e]&&this._threads[e].data("canMarkAsDone")&&this._threads[e].find(".jsMarkAsDone").data("threadID",e).dblclick($.proxy(this._dblclick,this))},_dblclick:function(e){var t,a=$(e.currentTarget);t="LI"==a[0].nodeName?!!a.find(".fa-check-square-o").length:!!a.hasClass("fa-check-square-o"),this._proxy.setOption("data",{actionName:(t?"un":"")+"done",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[a.data("threadID")]}),this._proxy.sendRequest()},_success:function(e,t,a){for(var s in e.returnValues.threadData)this._updateHandler.update(s,e.returnValues.threadData[s])}}),WBB.Thread.SimilarThreads=Class.extend({_proxy:null,_element:null,_boardID:0,init:function(e,t){this._element=e,this._boardID=t,this._proxy=new WCF.Action.Proxy({showLoadingOverlay:!1,success:$.proxy(this._success,this)}),e.on("blur",$.proxy(this._load,this))},_load:function(e){var t,a=$(e.currentTarget),s=a.val(),i=null;""!=s&&s.length>3?((t=$("#languageIDContainer > input[name=languageID]")).length&&(i=t.val()),this._proxy.setOption("data",{actionName:"getSimilarThreads",className:"wbb\\data\\thread\\ThreadAction",parameters:{topic:s,boardID:this._boardID,languageID:i}}),this._proxy.sendRequest()):this._element.parent().find(".wbbInlineSimilarThreadList").remove()},_success:function(e,t,a){this._element.parent().find(".wbbInlineSimilarThreadList").length>0?this._element.parent().find(".wbbInlineSimilarThreadList").replaceWith(e.returnValues.template):this._element.parent().append(e.returnValues.template)}}),WBB.Thread.WatchedThreadList=Class.extend({_button:null,_markAllCheckbox:null,init:function(){this._button=$("#stopWatchingButton").click($.proxy(this._stopWatching,this)),this._markAllCheckbox=$(".jsMarkAllWatchedThreads").change($.proxy(this._markAll,this)),$(".jsWatchedThread").change($.proxy(this._mark,this))},_mark:function(e){$(e.target).parents("ol.jsClipboardObject").toggleClass("jsMarked"),this._markAllCheckbox.is(":checked")?this._markAllCheckbox.prop("checked",!1):this._markAllCheckbox.prop("checked",0==$(".jsWatchedThread:not(:checked)").length),this._markAllCheckbox.parents(".tabularListColumns:eq(0)").toggleClass("jsMarked",this._markAllCheckbox.prop("checked")),this._updateButtonLabel()},_markAll:function(e){this._markAllCheckbox.parents(".tabularListColumns:eq(0)").toggleClass("jsMarked"),$(".jsWatchedThread").prop("checked",this._markAllCheckbox.prop("checked")).parents(".jsClipboardObject").toggleClass("jsMarked",this._markAllCheckbox.prop("checked")),this._updateButtonLabel()},_stopWatching:function(e){var t,a=$(".jsWatchedThread:checked"),s=[],i=!1;a.length?a.each((function(e,t){s.push($(t).data("objectID"))})):i=!0,t="wbb.thread.watchedThreads.stopWatchingMarked.confirmMessage",i&&(t="wbb.thread.watchedThreads.stopWatchingAll.confirmMessage"),WCF.System.Confirmation.show(WCF.Language.get(t),(function(e){"confirm"===e&&new WCF.Action.Proxy({autoSend:!0,data:{actionName:"stopWatching",className:"wbb\\data\\thread\\ThreadAction",parameters:{stopWatchingAll:i,threadIDs:s}},success:function(){window.location.reload()}})}))},_updateButtonLabel:function(){var e=$(".jsWatchedThread:checked"),t="";t=e.length?WCF.Language.get("wbb.thread.watchedThreads.stopWatchingMarked",{count:e.length}):WCF.Language.get("wbb.thread.watchedThreads.stopWatchingAll"),this._button.html(t)}}),WBB.Post={},WBB.Post.Add={},WBB.Post.Add.MessageOptions=Class.extend({_subscribeButton:null,init:function(){this._subscribeButton=$(".jsSubscribeButton"),WCF.System.Event.addListener("com.woltlab.wcf.redactor","updateMessageOptions",$.proxy(this._updateMessageOptions,this)),WCF.System.Event.addListener("com.woltlab.wcf.objectWatch","updatedSubscription",$.proxy(this._updateMessageOptions,this))},_updateMessageOptions:function(e){var t=$("#settings_text").find("input[name=subscribeThread]");t.length&&(this._subscribeButton.data("isSubscribed")?t.prop("checked","checked"):t.prop("checked",!1))}}),WBB.Post.Clipboard=Class.extend({_postManager:null,_threadUpdateHandler:null,init:function(e){this._postManager=e,WCF.System.Event.addListener("com.woltlab.wcf.clipboard","com.woltlab.wbb.post",function(e){null===e.responseData?this._execute(e.data.actionName,e.data.parameters):this._evaluateResponse(e.data.actionName,e.responseData)}.bind(this))},setThreadUpdateHandler:function(e){this._threadUpdateHandler=e},_execute:function(e,t){switch(e){case"com.woltlab.wbb.post.copyToExistingThread":WBB.Post.CopyToExistingThread.prepare(t);break;case"com.woltlab.wbb.post.copyToNewThread":WBB.Post.CopyToNewThread.prepare(t);break;case"com.woltlab.wbb.post.merge":new WBB.Post.MergeHandler(t.objectIDs).load();break;case"com.woltlab.wbb.post.moveToNewThread":WBB.Post.MoveToNewThread.prepare(t)}},_evaluateResponse:function(e,t){var a;if("com.woltlab.wbb.post.moveToExistingThread"!==e){if(t.returnValues.postData&&$.getLength(t.returnValues.postData)&&this._postManager._ajaxSuccess(t),this._threadUpdateHandler&&t.returnValues.threadData&&$.getLength(t.returnValues.threadData))for(a in t.returnValues.threadData)t.returnValues.threadData.hasOwnProperty(a)&&this._threadUpdateHandler.update(a,t.returnValues.threadData[a])}else(new WCF.System.Notification).show((function(){window.location=t.returnValues.redirectURL}))}}),WBB.Post.MergeHandler=WBB.Thread.MergeHandler.extend({init:function(e){this._super(e),this._className="wbb\\data\\post\\PostAction",this._dialogTitle=WCF.Language.get("wbb.post.edit.merge"),this._successMessage=WCF.Language.get("wbb.post.edit.merge.success")},_success:function(e,t,a){this._super(e,t,a),void 0===e.returnValues.redirectURL&&this._dialog.find(".formSubmit > button[data-type=submit]").enable()},_getParameters:function(){var e=[];return this._dialog.find(".jsPostContainer").each((function(t,a){e.push($(a).data("postID"))})),{postOrder:e}}}),WBB.Post.CopyToExistingThread={prepare:function(e){new WCF.System.Worker("copyToExistingThread","wbb\\data\\post\\PostAction",WCF.Language.get("wbb.post.copy.title"),e)}},WBB.Post.CopyToNewThread={_boardSelect:null,_dialog:null,_objectIDs:[],_submitButton:null,_topic:null,prepare:function(e){null===this._dialog?(this._dialog=$("<div>"+e.template+"</div>").hide().appendTo(document.body),this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.copy.title")})):this._dialog.html($.parseHTML(e.template)).wcfDialog("open"),this._boardSelect=$("#postCopyNewThreadBoardID"),this._objectIDs=e.objectIDs,this._submitButton=this._dialog.find(".formSubmit > button[data-type=submit]").disable().click($.proxy(this._submit,this)),this._topic=$("#postCopyNewThreadTopic").keyup($.proxy(this._keyUp,this)).focus(),$.trim(this._topic.val()).length&&this._submitButton.enable(),$.browser.mozilla&&$.browser.touch&&this._topic.on("input",$.proxy(this._keyUp,this))},_keyUp:function(){$.trim(this._topic.val()).length>0?this._submitButton.enable():this._submitButton.disable()},_submit:function(){this._dialog.wcfDialog("close"),new WCF.System.Worker("copyToNewThread","wbb\\data\\post\\PostAction",WCF.Language.get("wbb.post.copy.title"),{boardID:parseInt(this._boardSelect.val()),objectIDs:this._objectIDs,topic:$.trim(this._topic.val())})}},WBB.Post.MoveToNewThread={_boardSelect:null,_dialog:null,_objectIDs:[],_submitButton:null,_topic:null,prepare:function(e){null===this._dialog?(this._dialog=$("<div>"+e.template+"</div>").hide().appendTo(document.body),this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.moveToNewThread")})):this._dialog.html($.parseHTML(e.template)).wcfDialog("open"),this._boardSelect=$("#postMoveNewThreadBoardID"),this._objectIDs=e.objectIDs,this._submitButton=this._dialog.find(".formSubmit > button[data-type=submit]").disable().click($.proxy(this._submit,this)),this._topic=$("#postMoveNewThreadTopic").keyup($.proxy(this._keyUp,this)).focus(),$.trim(this._topic.val()).length&&this._submitButton.enable(),$.browser.mozilla&&$.browser.touch&&this._topic.on("input",$.proxy(this._keyUp,this))},_keyUp:function(){$.trim(this._topic.val()).length>0?this._submitButton.enable():this._submitButton.disable()},_submit:function(){this._submitButton.disable(),new WCF.Action.Proxy({autoSend:!0,data:{actionName:"moveToNewThread",className:"wbb\\data\\post\\PostAction",objectIDs:this._objectIDs,parameters:{boardID:parseInt(this._boardSelect.val()),topic:$.trim(this._topic.val())}},success:$.proxy(this._success,this)})},_success:function(e,t,a){(new WCF.System.Notification).show((function(){window.location=e.returnValues.redirectURL}))}},WBB.Post.Preview=WCF.Popover.extend({_proxy:null,init:function(){this._super(".wbbTopicLink, .wbbPostLink"),this._proxy=new WCF.Action.Proxy({showLoadingOverlay:!1}),WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.Preview",$.proxy(this._initContainers,this))},_loadContent:function(){var e,t,a=$("#"+this._activeElementID);a.hasClass("wbbTopicLink")?this._proxy.setOption("data",{actionName:"getPostPreview",className:"wbb\\data\\thread\\ThreadAction",objectIDs:[a.data("threadID")],parameters:{sortOrder:a.data("sortOrder")?a.data("sortOrder"):"ASC"}}):this._proxy.setOption("data",{actionName:"getPostPreview",className:"wbb\\data\\post\\PostAction",objectIDs:[a.data("postID")]}),e=this._activeElementID,t=this,this._proxy.setOption("success",(function(a,s,i){t._insertContent(e,a.returnValues.template,!0)})),this._proxy.setOption("failure",(function(a,s,i,n){return t._insertContent(e,a.message,!0),!1})),this._proxy.sendRequest()}}),WBB.Post.IPAddressHandler=Class.extend({_cache:{},_dialog:null,_proxy:null,init:function(){this._cache={},this._dialog=null,this._proxy=new WCF.Action.Proxy({success:$.proxy(this._success,this)}),this._initButtons(),WCF.DOMNodeInsertedHandler.addCallback("WBB.Post.IPAddressHandler",$.proxy(this._initButtons,this))},_initButtons:function(){var e=this;$(".jsIpAddress").each((function(t,a){var s=$(a),i=s.data("postID");void 0===e._cache[i]&&(e._cache[i]="",s.click($.proxy(e._click,e)))}))},_click:function(e){e.preventDefault();var t=$(e.currentTarget).data("postID");this._cache[t]?this._showDialog(t):(this._proxy.setOption("data",{actionName:"getIpLog",className:"wbb\\data\\post\\PostAction",parameters:{postID:t}}),this._proxy.sendRequest())},_success:function(e,t,a){this._cache[e.returnValues.postID]=e.returnValues.template,this._showDialog(e.returnValues.postID)},_showDialog:function(e){null===this._dialog&&(this._dialog=$('<div id="wbbIpAddressLog" />').hide().appendTo(document.body)),this._dialog.html(this._cache[e]),this._dialog.wcfDialog({title:WCF.Language.get("wbb.post.ipAddress.title")}),this._dialog.wcfDialog("render")}}),WBB.Post.QuoteHandler=WCF.Message.Quote.Handler.extend({init:function(e){this._super(e,"wbb\\data\\post\\PostAction","com.woltlab.wbb.post",".message",".messageBody",".messageBody > .messageText",!0)}});